C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DISPLAY
OBJECT MODULE PLACED IN .\Object\display.obj
COMPILER INVOKED BY: F:\工作软件\Keil\C51\BIN\C51.EXE SourceFile\display.c LARGE OMF2 BROWSE INCDIR(.\IncludeFile;..\tw_
                    -lib\sys;..\tw_lib\drivers;.\resource;.\i51) DEFINE(T123AI) DEBUG PRINT(.\List\display.lst) OBJECT(.\Object\display.obj)

line level    source

   1          #include "sys.h"
   2          #include "tw_widget_sys.h"
   3          #include "res.h"
   4          #include "spiosd.h"
   5          #include "osd2api.h"
   6          
   7          #include "page_main_internal.h"
   8          #include "videodetect.h"
   9          #include "disp_config.h"
  10          #include "display.h"
  11          #include "uart.h"
  12          #include "tw_timer.h"
  13          #include "mydrivers.h"
  14          
  15          TW_DATA  FLAG[5] = {0};
  16          struct tw_gicon *code alarm_pos[] =
  17          {
  18              //&page_main_internal_soc_7,
  19                  &page_main_internal_alarm_pos_0,
  20              &page_main_internal_alarm_pos_1,
  21              &page_main_internal_alarm_pos_2,
  22              &page_main_internal_alarm_pos_3,
  23              &page_main_internal_alarm_pos_4,
  24              &page_main_internal_alarm_pos_5,
  25          
  26          };
  27          
  28          
  29          
  30          struct tw_gicon *code fault_map[] =
  31          {
  32              &page_main_internal_fault_alarm_0,
  33              &page_main_internal_fault_alarm_1,
  34              &page_main_internal_fault_alarm_2,
  35              &page_main_internal_fault_alarm_3,
  36              &page_main_internal_fault_alarm_4,
  37              &page_main_internal_fault_alarm_5,
  38              &page_main_internal_fault_alarm_6,
  39              &page_main_internal_fault_alarm_7,
  40              &page_main_internal_fault_alarm_8,
  41              &page_main_internal_fault_alarm_9,
  42              &page_main_internal_fault_alarm_10,
  43              &page_main_internal_fault_alarm_11,
  44              &page_main_internal_fault_alarm_12,
  45              &page_main_internal_fault_alarm_13,
  46              &page_main_internal_fault_alarm_14,
  47              &page_main_internal_fault_alarm_15,
  48              &page_main_internal_fault_alarm_16,
  49              &page_main_internal_fault_alarm_17,
  50              &page_main_internal_fault_alarm_18,
  51              &page_main_internal_fault_alarm_19,
  52              &page_main_internal_fault_alarm_20,
  53              &page_main_internal_fault_alarm_21,
  54              &page_main_internal_fault_alarm_22,
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 2   

  55              &page_main_internal_fault_alarm_23,
  56              &page_main_internal_fault_alarm_24,
  57              &page_main_internal_fault_alarm_25,
  58              &page_main_internal_fault_alarm_26,
  59              &page_main_internal_fault_alarm_27,
  60              &page_main_internal_fault_alarm_28,
  61              &page_main_internal_fault_alarm_29,
  62              &page_main_internal_fault_alarm_30,
  63              &page_main_internal_fault_alarm_31,
  64              &page_main_internal_fault_alarm_32,
  65              &page_main_internal_fault_alarm_33,
  66              &page_main_internal_fault_alarm_34,
  67              &page_main_internal_fault_alarm_35,
  68              &page_main_internal_fault_alarm_36,
  69              &page_main_internal_fault_alarm_37,
  70              &page_main_internal_fault_alarm_38,
  71              &page_main_internal_fault_alarm_39,
  72              &page_main_internal_fault_alarm_40,
  73              &page_main_internal_fault_alarm_41,
  74              &page_main_internal_fault_alarm_42,
  75              &page_main_internal_fault_alarm_43,
  76              &page_main_internal_fault_alarm_44,
  77              &page_main_internal_fault_alarm_45,
  78              &page_main_internal_fault_alarm_46,
  79              &page_main_internal_fault_alarm_47,
  80              &page_main_internal_fault_alarm_48,
  81              &page_main_internal_fault_alarm_49,
  82              &page_main_internal_fault_alarm_50,
  83              &page_main_internal_fault_alarm_51,
  84              &page_main_internal_fault_alarm_52,
  85              &page_main_internal_fault_alarm_53,
  86              &page_main_internal_fault_alarm_54,
  87              &page_main_internal_fault_alarm_55,
  88              &page_main_internal_fault_alarm_56,
  89              &page_main_internal_fault_alarm_57,
  90              &page_main_internal_fault_alarm_58,
  91              &page_main_internal_fault_alarm_59,
  92              &page_main_internal_fault_alarm_60,
  93              &page_main_internal_fault_alarm_61,
  94              &page_main_internal_fault_alarm_62,
  95              &page_main_internal_fault_alarm_63,
  96              &page_main_internal_fault_alarm_64,
  97              &page_main_internal_fault_alarm_65,
  98              &page_main_internal_fault_alarm_66,
  99              &page_main_internal_fault_alarm_67,
 100              &page_main_internal_fault_alarm_68,
 101              &page_main_internal_fault_alarm_69,
 102              &page_main_internal_fault_alarm_70,
 103              &page_main_internal_fault_alarm_71,
 104              &page_main_internal_fault_alarm_72,
 105              &page_main_internal_fault_alarm_73,
 106              &page_main_internal_fault_alarm_74,
 107              &page_main_internal_fault_alarm_75,
 108              &page_main_internal_fault_alarm_76,
 109              &page_main_internal_fault_alarm_77,
 110              &page_main_internal_fault_alarm_78,
 111              &page_main_internal_fault_alarm_79,
 112              &page_main_internal_fault_alarm_80,
 113              &page_main_internal_fault_alarm_81,
 114              &page_main_internal_fault_alarm_82,
 115              &page_main_internal_fault_alarm_83,
 116              &page_main_internal_fault_alarm_84,
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 3   

 117              &page_main_internal_fault_alarm_85,
 118              &page_main_internal_fault_alarm_86,
 119              &page_main_internal_fault_alarm_87,
 120              &page_main_internal_fault_alarm_88,
 121              &page_main_internal_fault_alarm_89,
 122              &page_main_internal_fault_alarm_90,
 123              &page_main_internal_fault_alarm_91,
 124              &page_main_internal_fault_alarm_92,
 125              &page_main_internal_fault_alarm_93,
 126              &page_main_internal_fault_alarm_94,
 127              &page_main_internal_fault_alarm_95,
 128              &page_main_internal_fault_alarm_96,
 129              &page_main_internal_fault_alarm_97,
 130              &page_main_internal_fault_alarm_98,
 131              &page_main_internal_fault_alarm_99,
 132              &page_main_internal_fault_alarm_100,
 133              &page_main_internal_fault_alarm_101,
 134              &page_main_internal_fault_alarm_102,
 135              &page_main_internal_fault_alarm_103,
 136              &page_main_internal_fault_alarm_104,
 137              &page_main_internal_fault_alarm_105,
 138              &page_main_internal_fault_alarm_106,
 139              &page_main_internal_fault_alarm_107,
 140              &page_main_internal_fault_alarm_108,
 141              &page_main_internal_fault_alarm_109,
 142              &page_main_internal_fault_alarm_110,
 143              &page_main_internal_fault_alarm_111,
 144              &page_main_internal_fault_alarm_112,
 145              &page_main_internal_fault_alarm_113,
 146              &page_main_internal_fault_alarm_114,
 147              &page_main_internal_fault_alarm_115,
 148              &page_main_internal_fault_alarm_116,
 149              &page_main_internal_fault_alarm_117,
 150              &page_main_internal_fault_alarm_118,
 151              &page_main_internal_fault_alarm_119,
 152              &page_main_internal_fault_alarm_120,
 153              &page_main_internal_fault_alarm_121,
 154              &page_main_internal_fault_alarm_122,
 155              &page_main_internal_fault_alarm_123,
 156              &page_main_internal_fault_alarm_124,
 157              &page_main_internal_fault_alarm_125,
 158              &page_main_internal_fault_alarm_126,
 159              &page_main_internal_fault_alarm_127,
 160              &page_main_internal_fault_alarm_128,
 161              &page_main_internal_fault_alarm_129,
 162              &page_main_internal_fault_alarm_130,
 163              &page_main_internal_fault_alarm_131,
 164              &page_main_internal_fault_alarm_132,
 165              &page_main_internal_fault_alarm_133,
 166              &page_main_internal_fault_alarm_134,
 167              &page_main_internal_fault_alarm_135,
 168              &page_main_internal_fault_alarm_136,
 169              &page_main_internal_fault_alarm_137,
 170              &page_main_internal_fault_alarm_138,
 171              &page_main_internal_fault_alarm_139,
 172              &page_main_internal_fault_alarm_140,
 173              &page_main_internal_fault_alarm_141,
 174              &page_main_internal_fault_alarm_142,
 175              &page_main_internal_fault_alarm_143,
 176              &page_main_internal_fault_alarm_144,
 177              &page_main_internal_fault_alarm_145,
 178              &page_main_internal_fault_alarm_146,
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 4   

 179              &page_main_internal_fault_alarm_147,
 180              &page_main_internal_fault_alarm_148,
 181              &page_main_internal_fault_alarm_149,
 182              &page_main_internal_fault_alarm_150,
 183              &page_main_internal_fault_alarm_151,
 184              &page_main_internal_fault_alarm_152,
 185              &page_main_internal_fault_alarm_153,
 186              &page_main_internal_fault_alarm_154,
 187              &page_main_internal_fault_alarm_155,
 188              &page_main_internal_fault_alarm_156,
 189              &page_main_internal_fault_alarm_157,
 190              &page_main_internal_fault_alarm_158,
 191              &page_main_internal_fault_alarm_159,
 192              &page_main_internal_fault_alarm_160,
 193              &page_main_internal_fault_alarm_161,
 194              &page_main_internal_fault_alarm_162,
 195              &page_main_internal_fault_alarm_163,
 196              &page_main_internal_fault_alarm_164,
 197              &page_main_internal_fault_alarm_165,
 198              &page_main_internal_fault_alarm_166,
 199              &page_main_internal_fault_alarm_167,
 200              &page_main_internal_fault_alarm_168,
 201              &page_main_internal_fault_alarm_169,
 202              &page_main_internal_fault_alarm_170,
 203              &page_main_internal_fault_alarm_171,
 204              &page_main_internal_fault_alarm_172,
 205              &page_main_internal_fault_alarm_173,
 206              &page_main_internal_fault_alarm_174,
 207              &page_main_internal_fault_alarm_175,
 208              &page_main_internal_fault_alarm_176,
 209              &page_main_internal_fault_alarm_177,
 210                  &page_main_internal_fault_alarm_178,
 211                  &page_main_internal_fault_alarm_179,
 212                  &page_main_internal_fault_alarm_180,
 213                  &page_main_internal_fault_alarm_181,
 214                  &page_main_internal_fault_alarm_182,
 215                  &page_main_internal_fault_alarm_183,
 216                  &page_main_internal_fault_alarm_184,
 217                  &page_main_internal_fault_alarm_185,
 218                  &page_main_internal_fault_alarm_186,
 219                  &page_main_internal_fault_alarm_187,
 220                  &page_main_internal_fault_alarm_188,
 221                  &page_main_internal_fault_alarm_189,
 222                  &page_main_internal_fault_alarm_190,
 223                  &page_main_internal_fault_alarm_191,
 224                  &page_main_internal_fault_alarm_192,
 225                  &page_main_internal_fault_alarm_193,
 226                  &page_main_internal_fault_alarm_194,
 227                  &page_main_internal_fault_alarm_195,
 228                  &page_main_internal_fault_alarm_196,
 229                  &page_main_internal_fault_alarm_197,
 230                  &page_main_internal_fault_alarm_198,
 231                  &page_main_internal_fault_alarm_199,
 232          };
 233          
 234          struct tw_icon code *buzzer_map[2] =
 235          {
 236              &page_main_internal_font_open,
 237              &page_main_internal_font_close,
 238          };
 239          #if AIR_DISP
              struct tw_icon code *air_map[10] =
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 5   

              {
                  &page_main_internal_air_0,
                  &page_main_internal_air_1,
                  &page_main_internal_air_2,
                  &page_main_internal_air_3,
                  &page_main_internal_air_4,
                  &page_main_internal_air_5,
                  &page_main_internal_air_6,
                  &page_main_internal_air_7,
                  &page_main_internal_air_8,
                  &page_main_internal_air_9,
              };
              #endif
 254          #if BIG_SOC
              struct tw_gicon code *soc_map[101] =
              {
                  &page_main_internal_battery_0,
                  &page_main_internal_battery_1,
                  &page_main_internal_battery_2,
                  &page_main_internal_battery_3,
                  &page_main_internal_battery_4,
                  &page_main_internal_battery_5,
                  &page_main_internal_battery_6,
                  &page_main_internal_battery_7,
                  &page_main_internal_battery_8,
                  &page_main_internal_battery_9,
                  &page_main_internal_battery_10,
                  &page_main_internal_battery_11,
                  &page_main_internal_battery_12,
                  &page_main_internal_battery_13,
                  &page_main_internal_battery_14,
                  &page_main_internal_battery_15,
                  &page_main_internal_battery_16,
                  &page_main_internal_battery_17,
                  &page_main_internal_battery_18,
                  &page_main_internal_battery_19,
                  &page_main_internal_battery_20,
                  &page_main_internal_battery_21,
                  &page_main_internal_battery_22,
                  &page_main_internal_battery_23,
                  &page_main_internal_battery_24,
                  &page_main_internal_battery_25,
                  &page_main_internal_battery_26,
                  &page_main_internal_battery_27,
                  &page_main_internal_battery_28,
                  &page_main_internal_battery_29,
                  &page_main_internal_battery_30,
                  &page_main_internal_battery_31,
                  &page_main_internal_battery_32,
                  &page_main_internal_battery_33,
                  &page_main_internal_battery_34,
                  &page_main_internal_battery_35,
                  &page_main_internal_battery_36,
                  &page_main_internal_battery_37,
                  &page_main_internal_battery_38,
                  &page_main_internal_battery_39,
                  &page_main_internal_battery_40,
                  &page_main_internal_battery_41,
                  &page_main_internal_battery_42,
                  &page_main_internal_battery_43,
                  &page_main_internal_battery_44,
                  &page_main_internal_battery_45,
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 6   

                  &page_main_internal_battery_46,
                  &page_main_internal_battery_47,
                  &page_main_internal_battery_48,
                  &page_main_internal_battery_49,
                  &page_main_internal_battery_50,
                  &page_main_internal_battery_51,
                  &page_main_internal_battery_52,
                  &page_main_internal_battery_53,
                  &page_main_internal_battery_54,
                  &page_main_internal_battery_55,
                  &page_main_internal_battery_56,
                  &page_main_internal_battery_57,
                  &page_main_internal_battery_58,
                  &page_main_internal_battery_59,
                  &page_main_internal_battery_60,
                  &page_main_internal_battery_61,
                  &page_main_internal_battery_62,
                  &page_main_internal_battery_63,
                  &page_main_internal_battery_64,
                  &page_main_internal_battery_65,
                  &page_main_internal_battery_66,
                  &page_main_internal_battery_67,
                  &page_main_internal_battery_68,
                  &page_main_internal_battery_69,
                  &page_main_internal_battery_70,
                  &page_main_internal_battery_71,
                  &page_main_internal_battery_72,
                  &page_main_internal_battery_73,
                  &page_main_internal_battery_74,
                  &page_main_internal_battery_75,
                  &page_main_internal_battery_76,
                  &page_main_internal_battery_77,
                  &page_main_internal_battery_78,
                  &page_main_internal_battery_79,
                  &page_main_internal_battery_80,
                  &page_main_internal_battery_81,
                  &page_main_internal_battery_82,
                  &page_main_internal_battery_83,
                  &page_main_internal_battery_84,
                  &page_main_internal_battery_85,
                  &page_main_internal_battery_86,
                  &page_main_internal_battery_87,
                  &page_main_internal_battery_88,
                  &page_main_internal_battery_89,
                  &page_main_internal_battery_90,
                  &page_main_internal_battery_91,
                  &page_main_internal_battery_92,
                  &page_main_internal_battery_93,
                  &page_main_internal_battery_94,
                  &page_main_internal_battery_95,
                  &page_main_internal_battery_96,
                  &page_main_internal_battery_97,
                  &page_main_internal_battery_98,
                  &page_main_internal_battery_99,
                  &page_main_internal_battery_100,
              };
              #endif
 360          
 361          #if SMALL_SOC
 362          struct tw_icon code *soc_map[8] =
 363          {
 364              &page_main_internal_soc_0,
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 7   

 365              &page_main_internal_soc_1,
 366              &page_main_internal_soc_2,
 367              &page_main_internal_soc_3,
 368              &page_main_internal_soc_4,
 369              &page_main_internal_soc_5,
 370              &page_main_internal_soc_6,
 371              &page_main_internal_soc_7,
 372          };
 373          #endif
 374          
 375          void Deal_para (void)
 376          {
 377   1          unsigned char i, c_blink, b_x, b_y, temp[2];
 378   1          switch (para_cmd)
 379   1          {
 380   2              case PAGE_PASSWORD:
 381   2                  for (i = 0; i < 4; i++)
 382   2                  {
 383   3                      if (i == system_b_password.blink)
 384   3                      {
 385   4                          c_blink = 1;
 386   4                      }
 387   3                      else
 388   3                      {
 389   4                          c_blink = 0;
 390   4                      }
 391   3                      display_icon_uncolor_blink (*number_map[system_b_password.para[i]], 12 + i, 7, c_blink);
 392   3                  }
 393   2                  break;
 394   2              case PAGE_PARA:
 395   2                  for (i = 0; i < 11; i++)
 396   2                  {
 397   3                      if (i == system_b_set.blink)
 398   3                      {
 399   4                          c_blink = 1;
 400   4                      }
 401   3                      else
 402   3                      {
 403   4                          c_blink = 0;
 404   4                      }
 405   3                      switch (i)
 406   3                      {
 407   4                          case SET_HOUR:
 408   4                              b_x = 19;
 409   4                              b_y = 2;
 410   4                              break;
 411   4                          case SET_MINUTE:
 412   4                              b_x = 22;
 413   4                              b_y = 2;
 414   4                              break;
 415   4                          case SET_YEAR:
 416   4                              b_x = 21;
 417   4                              b_y = 4;
 418   4                              break;
 419   4                          case SET_MONTH:
 420   4                              b_x = 24;
 421   4                              b_y = 4;
 422   4                              break;
 423   4                          case SET_DAY:
 424   4                              b_x = 27;
 425   4                              b_y = 4;
 426   4                              break;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 8   

 427   4                          case SET_LIGHT:
 428   4                              b_x = 18;
 429   4                              b_y = 6;
 430   4                              break;
 431   4                          case SET_BUZZER:
 432   4                              b_x = 19;
 433   4                              b_y = 8;
 434   4                              break;
 435   4                          default:
 436   4                              break;
 437   4                      }
 438   3                      if (i < 6)
 439   3                      {
 440   4                          temp[0] = (system_b_set.para[i] >> 4) & 0x0f;
 441   4                          temp[1] = system_b_set.para[i] & 0x0f;
 442   4                          if (i != 5)
 443   4                          {
 444   5                              display_icon_uncolor_blink (*number_map[temp[0]], b_x, b_y, c_blink);
 445   5                          }
 446   4                          display_icon_uncolor_blink (*number_map[temp[1]], b_x + 1, b_y, c_blink);
 447   4                      }
 448   3                      else
 449   3                          if (i == 6)
 450   3                          {
 451   4                              display_icon_uncolor_blink (*buzzer_map[system_b_set.para[i]], b_x, b_y, c_blink);
 452   4                          }
 453   3                      #if 0
                                  else
                                      if (i == 7)
                                      {
                                          display_icon_uncolor_blink (*buzzer_map[system_b_set.para[i]], 39, 2, c_blink)
             -;
                                      }
                                      else
                                          if (i == 8)
                                          {
                                              display_icon_uncolor_blink (*buzzer_map[system_b_set.para[i]], 39, 3, c_bl
             -ink);
                                          }
                                          else
                                              if (i == 9)
                                              {
                                                  display_icon_uncolor_blink (*buzzer_map[system_b_set.para[i]], 39, 4, 
             -c_blink);
                                              }
                                              else
                                                  if (i == 10)
                                                  {
                                                      display_icon_uncolor_blink (*buzzer_map[system_b_set.para[i]], 39,
             - 5, c_blink);
                                                  }
                              #endif
 475   3                  }
 476   2                  break;
 477   2              case PAGE_SET:
 478   2                  for (i = 0; i < 44; i++)
 479   2                  {
 480   3                      if (i == system_b_odo_char.blink)
 481   3                      {
 482   4                          c_blink = 1;
 483   4                      }
 484   3                      else
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 9   

 485   3                      {
 486   4                          c_blink = 0;
 487   4                      }
 488   3                      if (i < 7)
 489   3                      {
 490   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], 19 + i, 9, c_blink
             -);
 491   4                      }
 492   3                          else  if (i < 11)
 493   3                      {
 494   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], 12 + i, 10, c_blin
             -k);
 495   4                      }
 496   3                          else if (i < 15)
 497   3                      {
 498   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], 8 + i, 11, c_blink
             -);
 499   4                      }
 500   3                          else if (i < 18)
 501   3                          {
 502   4                              display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], 4 + i, 12, c_blink);
 503   4                          }
 504   3                           else if (i < 21)
 505   3                          {
 506   4                              display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i + 1, 13, c_blink);
 507   4                          }
 508   3                          else if (i < 24)
 509   3                      {
 510   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i - 2, 14, c_blink
             -);
 511   4                      }
 512   3                          else if (i < 27)
 513   3                      {
 514   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i - 5, 15, c_blink
             -);
 515   4                      }
 516   3                          else if (i < 30)
 517   3                      {
 518   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i - 8, 16, c_blink
             -);
 519   4                      }
 520   3                          else if (i < 33)
 521   3                      {
 522   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i - 11, 17, c_blin
             -k);
 523   4                      }
 524   3                          else if (i < 36)
 525   3                      {
 526   4                          display_icon_uncolor_blink (*number_map[system_b_odo_char.para[i]], i + 7, 9, c_blink)
             -;
 527   4                      }
 528   3                          else if (i == 36)
 529   3                          {
 530   4                              display_icon_uncolor_blink (*buzzer_map[system_b_odo_char.para[i]], 40, 10, c_blink);
 531   4                          }
 532   3                          else if (i == 37)
 533   3                          {
 534   4                              display_icon_uncolor_blink (*buzzer_map[system_b_odo_char.para[i]], 40, 11, c_blink);
 535   4                          }
 536   3                          else if(i == 38)
 537   3                                              display_icon_uncolor_blink(*buzzer_map[system_b_odo_char.para[i]],40,12,c_blink);
 538   3                                      else if(i == 39)
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 10  

 539   3                                              display_icon_uncolor_blink(*buzzer_map[system_b_odo_char.para[i]],40,13,c_blink);
 540   3                                      else if(i== 40)
 541   3                                              display_icon_uncolor_blink(*buzzer_map[system_b_odo_char.para[i]],40,14,c_blink);
 542   3                                      else if(i < 44)
 543   3                                              display_icon_uncolor_blink(*number_map[system_b_odo_char.para[i]],i - 1,15,c_blink);
 544   3                  }
 545   2                  break;
 546   2          }
 547   1      }
 548          
 549          void protocl_event (unsigned char cmd_type)
 550          {
 551   1          #if MODULE_FRONT_B50 || MODULE_REAR_B50 || MODULE_TOP_B50
                  unsigned char i;
                  #endif
 554   1          switch (cmd_type)
 555   1          {
 556   2              case UART1_MAIN_PAGE:
 557   2                  if (system_page.current_page == UART1_MAIN_PAGE)
 558   2                  {
 559   3                      display_air();
 560   3                      switch (dandu_disp)
 561   3                      {
 562   4                          case MAIN_MARK:
 563   4                              display_mark();
 564   4                              break;
 565   4                          case MAIN_MILE:
 566   4                              display_mileage();
 567   4                              break;
 568   4                          case MAIN_TIME:
 569   4                              if (DISP_AIR)
 570   4                              {
 571   5                                  display_air();
 572   5                              }
 573   4                              if (DISP_SOC)
 574   4                              {
 575   5                                  display_soc();
 576   5                              }
 577   4                              if (DISP_TIME)
 578   4                              {
 579   5                                  display_system_time();
 580   5                              }
 581   4                              DISP_AIR = 0;
 582   4                              DISP_SOC = 0;
 583   4                              DISP_TIME = 0;
 584   4                              break;
 585   4                          case MAIN_DATA:
 586   4                              diplay_main_data();
 587   4                              break;
 588   4                          default:
 589   4                              break;
 590   4                      }
 591   3                      dandu_disp = 0;
 592   3                  }
 593   2                  break;
 594   2              case UART1_MENU_PAGE:
 595   2                  if (system_page.current_page == UART1_MENU_PAGE)
 596   2                  {
 597   3                      clear_unalarm_area();
 598   3                      if (menu < CURSOR_NUM)
 599   3                      {
 600   4                          display_uncolor_icon (page_main_internal_arrows, CURSOR_R_X, CURSOR_R_Y - menu);
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 11  

 601   4                      }
 602   3                      else
 603   3                      {
 604   4                          display_uncolor_icon (page_main_internal_arrows, CURSOR_L_X, CURSOR_L_Y - menu);
 605   4                      }
 606   3                  }
 607   2                  break;
 608   2              case UART1_PARA_PAGE:
 609   2                  if (system_page.current_page == UART1_PARA_PAGE)
 610   2                  {
 611   3                      Deal_para();
 612   3                  }
 613   2                  break;
 614   2              case UART1_VIDEO_PAGE:
 615   2                  //CVBS0:ACB0 -倒车
 616   2                  //CVBS1:AY0 -中门
 617   2                  //CVBS2:ACR0-前门
 618   2                  //CVBS3:ACB2-备用
 619   2                  if (system_page.current_page == UART1_VIDEO_PAGE)
 620   2                  {
 621   3                      tw_timer_open (100);
 622   3                      display_icon (page_main_internal_av, GREEN, 46, 1);
 623   3                      if (system_video == ICVBS0) //okacb2
 624   3                      {
 625   4                          IC_WritByte (TWIC_P0, 0x0f, 0x40);
 626   4                          IC_WritByte (TWIC_P0, 0x18, 0x30);
 627   4                          IC_WritByte (TWIC_P0, 0x19, 0x0c);
 628   4                          display_icon (*number_map[1], GREEN, 48, 1);
 629   4                      }
 630   3                      else
 631   3                          if (system_video == ICVBS1) //okacr0
 632   3                          {
 633   4                              IC_WritByte (TWIC_P0, 0x0f, 0x00);
 634   4                              IC_WritByte (TWIC_P0, 0x19, 0x80);
 635   4                              IC_WritByte (TWIC_P1, 0x13, 0x02);
 636   4                              display_icon (*number_map[2], GREEN, 48, 1);
 637   4                          }
 638   3                          else
 639   3                              if (system_video == ICVBS2) //ok acb0
 640   3                              {
 641   4                                  IC_WritByte (TWIC_P0, 0x0f, 0x00);
 642   4                                  IC_WritByte (TWIC_P0, 0x19, 0x80);
 643   4                                  IC_WritByte (TWIC_P1, 0x13, 0x06);
 644   4                                  display_icon (*number_map[3], GREEN, 48, 1);
 645   4                              }
 646   3                              else
 647   3                                  if (system_video == ICVBS3) //ok ay0
 648   3                                  {
 649   4                                      IC_WritByte (TWIC_P0, 0x0f, 0x00);
 650   4                                      IC_WritByte (TWIC_P0, 0x19, 0x80);
 651   4                                      IC_WritByte (TWIC_P1, 0x13, 0x00);
 652   4                                      display_icon (*number_map[4], GREEN, 48, 1);
 653   4                                  }
 654   3                  }
 655   2                  break;
 656   2              case UART1_METER_PAGE:
 657   2                  if (system_page.current_page == UART1_METER_PAGE)
 658   2                  {
 659   3                      if (status_para_change == 1)
 660   3                      {
 661   4                          display_meter_status();
 662   4                      }
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 12  

 663   3                      #if METER_C50
                              else
                                  if (status_para_change == 2)
                                  {
                                      displayu16 (43, 11, meter_para_A2, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 12, meter_para_A3, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 13, meter_para_A4, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                  }
                                  else
                                      if (status_para_change == 3)
                                      {
                                          displayu16 (43, 14, meter_para_A5, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                          displayu16 (43, 15, meter_para_A13, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                          displayu16 (43, 16, meter_para_A14, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      }
                              #elif METER_C61
                              else
                                  if (status_para_change == 2)
                                  {
                                      displayu16 (43, 6, meter_para_A2, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 7, meter_para_A3, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 8, meter_para_A4, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 9, meter_para_A5, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                  }
                                  else
                                      if (status_para_change == 3)
                                      {
                                          displayu16 (43, 10, meter_para_A13, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      }
                              #elif METER_C52
 693   3                      else
 694   3                          if (status_para_change == 2)
 695   3                          {
 696   4                              displayu16 (43, 10, meter_para_A2, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 697   4                              displayu16 (43, 11, meter_para_A3, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 698   4                              displayu16 (43, 12, meter_para_A4, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 699   4                                                      displayu8  (27, 17, meter_para_K, 2, 0, GREEN, FULLSPACE, FONT_SMALL);
 700   4                              displayu8  (37, 17, meter_para_T, 2, 0, GREEN, FULLSPACE, FONT_SMALL);
 701   4                          }
 702   3                          else
 703   3                              if (status_para_change == 3)
 704   3                              {
 705   4                                  displayu16 (43, 13, meter_para_A5, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 706   4                                  displayu16 (43, 14, meter_para_A13, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 707   4                                  displayu16 (43, 15, meter_para_A14, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 708   4                                  displayu16 (43, 16, meter_para_A15, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 709   4                              }
 710   3                      #endif
 711   3                  }
 712   2                  break;
 713   2              case UART1_FRONT_PAGE:
 714   2                  if (system_page.current_page == UART1_FRONT_PAGE)
 715   2                  {
 716   3                      if (status_para_change == 1)
 717   3                      {
 718   4                          #if MODULE_FRONT_B40
 719   4                          display_moudle_output_status (1, front_status[0], front_status[1]);
 720   4                          display_moudle_input_status (front_status[2], front_status[3]);
 721   4                          #endif
 722   4                          #if MODULE_FRONT_B50
                                  display_moudle_input_status (front_status[0], front_status[1]);
                                  #endif
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 13  

 725   4                      }
 726   3                      else
 727   3                          if (status_para_change == 2)
 728   3                          {
 729   4                              #if MODULE_FRONT_B40
 730   4                              displayu16 (43, 7, front_para_A25, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 731   4                              displayu16 (43, 9, front_para_A40, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 732   4                              displayu16 (43, 11, front_para_A26, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 733   4                              #endif
 734   4                              #if MODULE_FRONT_B50
                                      for (i = 0; i < 7; i++)
                                      {
                                          if ((i > 3) && (i < 6))
                                          {
                                              displayu16 (43, 6 + i, front_para[i], 3, 2, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                          else
                                          {
                                              displayu16 (43, 6 + i, front_para[i], 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                      }
                                      #endif
 747   4                          }
 748   3                  }
 749   2                  break;
 750   2              case UART1_REAR_PAGE:
 751   2                  if (system_page.current_page == UART1_REAR_PAGE)
 752   2                  {
 753   3                      if (status_para_change == 1)
 754   3                      {
 755   4                          #if MODULE_REAR_B40
 756   4                          display_moudle_output_status (1, rear_status[0], rear_status[1]);
 757   4                          display_moudle_input_status (rear_status[2], rear_status[3]);
 758   4                          #endif
 759   4                          #if MODULE_REAR_B50
                                  display_moudle_input_status (rear_status[0], rear_status[1]);
                                  #endif
 762   4                      }
 763   3                      else
 764   3                          if (status_para_change == 2)
 765   3                          {
 766   4                              #if MODULE_REAR_B40
 767   4                              displayu16 (43, 7, rear_para_A25, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 768   4                              displayu16 (43, 9, rear_para_A40, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 769   4                              displayu16 (43, 11, rear_para_A26, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
 770   4                              #endif
 771   4                              #if MODULE_REAR_B50
                                      for (i = 0; i < 7; i++)
                                      {
                                          if ((i > 4) && (i < 6))
                                          {
                                              displayu16 (43, 6 + i, rear_para[i], 3, 2, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                          else
                                          {
                                              displayu16 (43, 6 + i, rear_para[i], 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                      }
                                      #endif
 784   4                          }
 785   3                  }
 786   2                  break;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 14  

 787   2              case UART1_TOP_PAGE:
 788   2                  if (system_page.current_page == UART1_TOP_PAGE)
 789   2                  {
 790   3                      if (status_para_change == 1)
 791   3                      {
 792   4                          #if MODULE_TOP_B40
                                  display_moudle_output_status (1, top_status[0], top_status[1]);
                                  display_moudle_input_status (top_status[2], top_status[3]);
                                  #endif
 796   4                          #if MODULE_TOP_B50
                                  display_moudle_input_status (top_status[0], top_status[1]);
                                  #endif
 799   4                      }
 800   3                      else
 801   3                          if (status_para_change == 2)
 802   3                          {
 803   4                              #if MODULE_TOP_B40
                                      displayu16 (43, 7, top_para_A25, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 9, top_para_A40, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      displayu16 (43, 11, top_para_A26, 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                      #endif
 808   4                              #if MODULE_TOP_B50
                                      for (i = 0; i < 7; i++)
                                      {
                                          if ((i > 3) && (i < 6))
                                          {
                                              displayu16 (43, 6 + i, top_para[i], 3, 2, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                          else
                                          {
                                              displayu16 (43, 6 + i, top_para[i], 5, 0, GREEN, FULLSPACE, FONT_SMALL);
                                          }
                                      }
                                      #endif
 821   4                          }
 822   3                  }
 823   2                  break;
 824   2              case UART1_FRONT_OUT_PAGE:
 825   2                  if (system_page.current_page == UART1_FRONT_OUT_PAGE)
 826   2                  {
 827   3                      #if MODULE_FRONT_B50
                              display_moudle_output_status (1, front_out_status[0], front_out_status[1]);
                              display_moudle_output_status (18, front_out_status[2], front_out_status[3]);
                              display_moudle_output_status (34, front_out_status[4], front_out_status[5]);
                              #endif
 832   3                  }
 833   2                  break;
 834   2              case UART1_REAR_OUT_PAGE:
 835   2                  if (system_page.current_page == UART1_REAR_OUT_PAGE)
 836   2                  {
 837   3                      #if MODULE_REAR_B50
                              display_moudle_output_status (1, rear_out_status[0], rear_out_status[1]);
                              display_moudle_output_status (18, rear_out_status[2], rear_out_status[3]);
                              display_moudle_output_status (34, rear_out_status[4], rear_out_status[5]);
                              #endif
 842   3                  }
 843   2                  break;
 844   2              case UART1_TOP_OUT_PAGE:
 845   2                  if (system_page.current_page == UART1_TOP_OUT_PAGE)
 846   2                  {
 847   3                      #if MODULE_TOP_B50
                              display_moudle_output_status (1, top_out_status[0], top_out_status[1]);
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 15  

                              display_moudle_output_status (18, top_out_status[2], top_out_status[3]);
                              display_moudle_output_status (34, top_out_status[4], top_out_status[5]);
                              #endif
 852   3                  }
 853   2                  break;
 854   2              case UART1_SURFACE1_PAGE:
 855   2                  #if (PAGE_ADD > 0)
 856   2                  if (system_page.current_page == UART1_SURFACE1_PAGE)
 857   2                  {
 858   3                      display_surface1();
 859   3                  }
 860   2                  #endif
 861   2                  break;
 862   2              case UART1_SURFACE2_PAGE:
 863   2                  #if (PAGE_ADD > 1)
 864   2                  if (system_page.current_page == UART1_SURFACE2_PAGE)
 865   2                  {
 866   3                      display_surface2();
 867   3                  }
 868   2                  #endif
 869   2                  break;
 870   2              case UART1_SURFACE3_PAGE:
 871   2                  #if (PAGE_ADD > 2)
 872   2                  if (system_page.current_page == UART1_SURFACE3_PAGE)
 873   2                  {
 874   3                      display_surface3();
 875   3                  }
 876   2                  #endif
 877   2                  break;
 878   2              case UART1_SURFACE4_PAGE:
 879   2                  #if (PAGE_ADD > 3)
 880   2                  if (system_page.current_page == UART1_SURFACE4_PAGE)
 881   2                  {
 882   3                      display_surface4();
 883   3                  }
 884   2                  #endif
 885   2                  break;
 886   2              case UART1_SURFACE5_PAGE:
 887   2                  #if (PAGE_ADD > 4)
 888   2                  if (system_page.current_page == UART1_SURFACE5_PAGE)
 889   2                  {
 890   3                      display_surface5();
 891   3                  }
 892   2                  #endif
 893   2                  break;
 894   2              case UART1_SURFACE6_PAGE:
 895   2                  #if (PAGE_ADD > 5)
 896   2                  if (system_page.current_page == UART1_SURFACE6_PAGE)
 897   2                  {
 898   3                      display_surface6();
 899   3                  }
 900   2                  #endif
 901   2                  break;
 902   2              case UART1_SURFACE7_PAGE:
 903   2                  #if (PAGE_ADD > 6)
 904   2                  if (system_page.current_page == UART1_SURFACE7_PAGE)
 905   2                  {
 906   3                      display_surface7();
 907   3                  }
 908   2                  #endif
 909   2                  break;
 910   2              case UART1_SURFACE8_PAGE:
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 16  

 911   2                  #if (PAGE_ADD > 7)
 912   2                  if (system_page.current_page == UART1_SURFACE8_PAGE)
 913   2                  {
 914   3                      display_surface8();
 915   3                  }
 916   2                  #endif
 917   2                  break;
 918   2              case UART1_SURFACE9_PAGE:
 919   2                  #if (PAGE_ADD > 8)
 920   2                  if (system_page.current_page == UART1_SURFACE9_PAGE)
 921   2                  {
 922   3                      display_surface9();
 923   3                  }
 924   2                  #endif
 925   2                  break;
 926   2              case UART1_SURFACE10_PAGE:
 927   2                  #if (PAGE_ADD > 9)
 928   2                  if (system_page.current_page == UART1_SURFACE10_PAGE)
 929   2                  {
 930   3                      display_surface10();
 931   3                  }
 932   2                  #endif
 933   2                  break;
 934   2              case UART1_SURFACE11_PAGE:
 935   2                  #if (PAGE_ADD > 10)
 936   2                  if (system_page.current_page == UART1_SURFACE11_PAGE)
 937   2                  {
 938   3                      display_surface11();
 939   3                  }
 940   2                  #endif
 941   2                  break;
 942   2              case UART1_SURFACE12_PAGE:
 943   2                  #if (PAGE_ADD > 11)
 944   2                  if (system_page.current_page == UART1_SURFACE12_PAGE)
 945   2                  {
 946   3                      display_surface12();
 947   3                  }
 948   2                  #endif
 949   2                  break;
 950   2              case UART1_SURFACE13_PAGE:
 951   2                  #if (PAGE_ADD > 12)
 952   2                  if (system_page.current_page == UART1_SURFACE13_PAGE)
 953   2                  {
 954   3                      display_surface13();
 955   3                  }
 956   2                  #endif
 957   2                  break;
 958   2              case UART1_SURFACE14_PAGE:
 959   2                  #if (PAGE_ADD > 13)
 960   2                  if (system_page.current_page == UART1_SURFACE14_PAGE)
 961   2                  {
 962   3                      display_surface14();
 963   3                  }
 964   2                  #endif
 965   2                  break;
 966   2              case UART1_SURFACE15_PAGE:
 967   2                  #if (PAGE_ADD > 14)
 968   2                  if (system_page.current_page == UART1_SURFACE15_PAGE)
 969   2                  {
 970   3                      display_surface15();
 971   3                  }
 972   2                  #endif
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 17  

 973   2                  break;
 974   2              case UART1_SURFACE16_PAGE:
 975   2                  #if (PAGE_ADD > 15)
 976   2                  if (system_page.current_page == UART1_SURFACE16_PAGE)
 977   2                  {
 978   3                      display_surface16();
 979   3                  }
 980   2                  #endif
 981   2                  break;
 982   2              case UART1_SURFACE17_PAGE:
 983   2                  #if (PAGE_ADD > 16)
 984   2                  if (system_page.current_page == UART1_SURFACE17_PAGE)
 985   2                  {
 986   3                      display_surface17();
 987   3                  }
 988   2                  #endif
 989   2                  break;
 990   2              case UART1_SURFACE18_PAGE:
 991   2                  #if (PAGE_ADD > 17)
 992   2                  if (system_page.current_page == UART1_SURFACE18_PAGE)
 993   2                  {
 994   3                      display_surface18();
 995   3                  }
 996   2                  #endif
 997   2                  break;
 998   2              case UART1_SURFACE19_PAGE:
 999   2                  #if (PAGE_ADD > 18)
1000   2                  if (system_page.current_page == UART1_SURFACE19_PAGE)
1001   2                  {
1002   3                      display_surface19();
1003   3                  }
1004   2                  #endif
1005   2                  break;
1006   2              case UART1_SURFACE20_PAGE:
1007   2                  #if (PAGE_ADD > 19)
                          if (system_page.current_page == UART1_SURFACE20_PAGE)
                          {
                              display_surface20();
                          }
                          #endif
1013   2                  break;
1014   2              case UART1_SURFACE21_PAGE:
1015   2                  #if (PAGE_ADD > 20)
                          if (system_page.current_page == UART1_SURFACE21_PAGE)
                          {
                              display_surface21();
                          }
                          #endif
1021   2                  break;
1022   2              case GD_ALARM:
1023   2                  //if((check_page(system_page.current_page) > 1) && (check_page(system_page.current_page) != ID
             -_PAGE_VIDEO) && (check_page(system_page.current_page) != ID_PAGE_LOGO) && (check_page(system_page.current_page) < 31))
1024   2                  if ((system_page.current_page > 0) && (system_page.current_page != 3) && (system_page.current_
             -page != 6) && (system_page.current_page < 0x36))
1025   2                  {
1026   3                      display_fault_message();
1027   3                      if ((system_page.current_page == UART1_MAIN_PAGE) && (DISP_MILE))
1028   3                      {
1029   4                          display_mileage();
1030   4                      }
1031   3                      DISP_MILE = 0;
1032   3                  }
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 18  

1033   2                  break;
1034   2              case GD_PAGE_CHANGE:
1035   2                  page_switch();
1036   2                  break;
1037   2              default:
1038   2                  break;
1039   2          }
1040   1      }
1041          //------------------------------------------------------------------------------------
1042          void display_meter_status (void)
1043          {
1044   1          unsigned char i;
1045   1          unsigned int temp;
1046   1          temp = meter_status[0];
1047   1          for (i = 0; i < 16; i++)
1048   1          {
1049   2              if (temp & 0x01)
1050   2              {
1051   3                  display_uncolor_icon (page_main_internal_status_green, 1, 1 + i);
1052   3              }
1053   2              else
1054   2              {
1055   3                  clear_icon (page_main_internal_status_green, 1, 1 + i);
1056   3              }
1057   2              temp >>= 1;
1058   2          }
1059   1          temp = meter_status[1];
1060   1          #if METER_C50
                  for (i = 0; i < 16; i++)
                  {
                      if (temp & 0x01)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      else
                      {
                          clear_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      temp >>= 1;
                  }
                  temp = meter_status[2];
                  for (i = 0; i < 8; i++)
                  {
                      if (temp & 0x01)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 34, 1 + i);
                      }
                      else
                      {
                          clear_icon (page_main_internal_status_green, 34, 1 + i);
                      }
                      temp >>= 1;
                  }
                  temp = meter_status[3];
                  for (i = 0; i < 2; i++)
                  {
                      if ((temp & 0x03) == 0)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 34, 9 + i);
                      }
                      else
                          if ((temp & 0x03) == 2)
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 19  

                          {
                              display_uncolor_icon (page_main_internal_status_red, 34, 9 + i);
                          }
                          else
                          {
                              clear_area_block (34, 9 + i, 2, 1);
                          }
                      temp >>= 2;
                  }
                  #elif   METER_C61
                  for (i = 0; i < 11; i++)
                  {
                      if (temp & 0x01)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      else
                      {
                          clear_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      temp >>= 1;
                  }
                  temp = meter_status[3];
                  for (i = 0; i < 2; i++)
                  {
                      if ((temp & 0x03) == 0)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 18, 12 + i);
                      }
                      else
                          if ((temp & 0x03) == 2)
                          {
                              display_uncolor_icon (page_main_internal_status_red, 18, 12 + i);
                          }
                          else
                          {
                              clear_area_block (18, 12 + i, 2, 1);
                          }
                      temp >>= 2;
                  }
                  #elif   METER_C52
1136   1          for (i = 0; i < 16; i++)
1137   1          {
1138   2              if (temp & 0x01)
1139   2              {
1140   3                  display_uncolor_icon (page_main_internal_status_green, 18, 1 + i);
1141   3              }
1142   2              else
1143   2              {
1144   3                  clear_icon (page_main_internal_status_green, 18, 1 + i);
1145   3              }
1146   2              temp >>= 1;
1147   2          }
1148   1          temp = meter_status[2];
1149   1          for (i = 0; i < 9; i++)
1150   1          {
1151   2              if (temp & 0x01)
1152   2              {
1153   3                  display_uncolor_icon (page_main_internal_status_green, 34, 1 + i);
1154   3              }
1155   2              else
1156   2              {
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 20  

1157   3                  clear_icon (page_main_internal_status_green, 34, 1 + i);
1158   3              }
1159   2              temp >>= 1;
1160   2          }
1161   1      
1162   1          #endif
1163   1      }
1164          void display_moudle_output_status (unsigned char x, unsigned int Lstatus, unsigned int Hstatus)
1165          {
1166   1          unsigned char i;
1167   1          unsigned long temp;
1168   1          temp = Hstatus;
1169   1          temp <<= 16;
1170   1          temp |= Lstatus;
1171   1          #if MODULE_FRONT_B40 || MODULE_REAR_B40 || MODULE_TOP_B40
1172   1          #if B40_INPUT_ORDER
                  for (i = 0; i < 15; i++)
                  {
                      if ((temp & 0x03) == 0)
                      {
                          display_uncolor_icon (page_main_internal_status_green, x, 1 + i);
                      }
                      else
                          if ((temp & 0x03) == 2)
                          {
                              display_uncolor_icon (page_main_internal_status_red, x, 1 + i);
                          }
                          else
                          {
                              clear_area_block (x, 1 + i, 2, 1);
                          }
                      temp >>= 2;
                  }
                  #else
1191   1          for (i = 0; i < 8; i++)
1192   1          {
1193   2              if ((temp & 0x03) == 0)
1194   2              {
1195   3                  display_uncolor_icon (page_main_internal_status_green, x, 1 + 2 * i);
1196   3              }
1197   2              else
1198   2                  if ((temp & 0x03) == 2)
1199   2                  {
1200   3                      display_uncolor_icon (page_main_internal_status_red, x, 1 + 2 * i);
1201   3                  }
1202   2                  else
1203   2                  {
1204   3                      clear_area_block (x, 1 + 2 * i, 2, 1);
1205   3                  }
1206   2              temp >>= 2;
1207   2          }
1208   1          for (i = 0; i < 7; i++)
1209   1          {
1210   2              if ((temp & 0x03) == 0)
1211   2              {
1212   3                  display_uncolor_icon (page_main_internal_status_green, x, 2 + 2 * i);
1213   3              }
1214   2              else
1215   2                  if ((temp & 0x03) == 2)
1216   2                  {
1217   3                      display_uncolor_icon (page_main_internal_status_red, x, 2 + 2 * i);
1218   3                  }
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 21  

1219   2                  else
1220   2                  {
1221   3                      clear_area_block (x, 2 + 2 * i, 2, 1);
1222   3                  }
1223   2              temp >>= 2;
1224   2          }
1225   1          #endif
1226   1          #endif
1227   1          #if MODULE_FRONT_B50 || MODULE_REAR_B50 || MODULE_TOP_B50
                  for (i = 0; i < 8; i++)
                  {
                      if ((temp & 0x0f) == 1)
                      {
                          display_uncolor_icon (page_main_internal_status_green, x, 1 + i * 2);
                      }
                      else
                          if ((temp & 0x0f) == 3)
                          {
                              display_uncolor_icon (page_main_internal_status_red, x, 1 + i * 2);
                          }
                          else
                              if ((temp & 0x0f) == 4)
                              {
                                  display_uncolor_icon (page_main_internal_status_yellow, x, 1 + i * 2);
                              }
                              else
                              {
                                  clear_area_block (x, 1 + i * 2, 2, 1);
                              }
                      temp >>= 4;
                  }
                  #endif
1251   1      }
1252          void display_moudle_input_status (unsigned int status, unsigned int vestigital)
1253          {
1254   1          unsigned char i;
1255   1          unsigned int temp;
1256   1          temp = status;
1257   1          #if MODULE_FRONT_B40 || MODULE_REAR_B40 || MODULE_TOP_B40
1258   1          for (i = 0; i < 15; i++)
1259   1          {
1260   2              if (temp & 0x01)
1261   2              {
1262   3                  display_uncolor_icon (page_main_internal_status_green, 18, 1 + i);
1263   3              }
1264   2              else
1265   2              {
1266   3                  clear_icon (page_main_internal_status_green, 18, 1 + i);
1267   3              }
1268   2              temp >>= 1;
1269   2          }
1270   1          if (vestigital & 0x01)
1271   1          {
1272   2              display_uncolor_icon (page_main_internal_status_green, 1, 16);
1273   2          }
1274   1          else
1275   1          {
1276   2              clear_icon (page_main_internal_status_green, 1, 16);
1277   2          }
1278   1          if (vestigital & 0x02)
1279   1          {
1280   2              display_uncolor_icon (page_main_internal_status_green, 18, 16);
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 22  

1281   2          }
1282   1          else
1283   1          {
1284   2              clear_icon (page_main_internal_status_green, 18, 16);
1285   2          }
1286   1          #endif
1287   1          #if MODULE_FRONT_B50 || MODULE_REAR_B50 || MODULE_TOP_B50
                  for (i = 0; i < 16; i++)
                  {
                      if (temp & 0x01)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 1, 1 + i);
                      }
                      else
                      {
                          clear_icon (page_main_internal_status_green, 1, 1 + i);
                      }
                      temp >>= 1;
                  }
                  temp = vestigital;
                  for (i = 0; i < 10; i++)
                  {
                      if (temp & 0x01)
                      {
                          display_uncolor_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      else
                      {
                          clear_icon (page_main_internal_status_green, 18, 1 + i);
                      }
                      temp >>= 1;
                  }
                  #endif
1314   1      }
1315          
1316          void display_unmark (void)
1317          {
1318   1          unsigned char i;
1319   1      
1320   1          for (i = 0; i < 16; i++)
1321   1          {
1322   2              display_uncolor_icon (page_main_internal_black, 1 + i * 3, 0);
1323   2          }
1324   1      
1325   1          for (i = 0; i < 7; i++)
1326   1          {
1327   2              display_uncolor_icon (page_main_internal_black, 1 + i * 3, 2);
1328   2          }
1329   1          for (i = 0; i < 4; i++)
1330   1          {
1331   2              display_uncolor_icon (page_main_internal_black, 37 + i * 3, 2);
1332   2          }
1333   1              
1334   1                //  display_uncolor_icon (page_main_internal_black,1, 4);
1335   1              
1336   1          #if HAVE_READY
1337   1          display_uncolor_icon (page_main_internal_black, 22, 2);
1338   1          display_uncolor_icon (page_main_internal_black, 25, 2);
1339   1          #endif
1340   1      }
1341          void display_mark (void)
1342          {
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 23  

1343   1          unsigned char i;
1344   1          unsigned long temp;
1345   1          temp = mark_door;
1346   1      
1347   1          for (i = 0; i < 16; i++)
1348   1          {
1349   2              if (temp & 0x80000000)
1350   2              {
1351   3                  clear_icon (page_main_internal_black, 3 * i + 1, 0);
1352   3              }
1353   2              else
1354   2              {
1355   3                  display_uncolor_icon (page_main_internal_black, 1 + i * 3, 0);
1356   3              }
1357   2              temp <<= 1;
1358   2          }
1359   1          if (mark_door & 0x00008000)
1360   1          {
1361   2              clear_icon (page_main_internal_black, 7, 2);
1362   2          }
1363   1          else
1364   1          {
1365   2              display_uncolor_icon (page_main_internal_black, 7, 2);
1366   2          }
1367   1          if (mark_door & 0x00004000)
1368   1          {
1369   2              clear_icon (page_main_internal_black, 10, 2);
1370   2          }
1371   1          else
1372   1          {
1373   2              display_uncolor_icon (page_main_internal_black, 10, 2);
1374   2          }
1375   1      
1376   1          if (mark2 & 0x80)
1377   1          {
1378   2              clear_icon (page_main_internal_black, 13, 2);
1379   2          }
1380   1          else
1381   1          {
1382   2              display_uncolor_icon (page_main_internal_black, 13, 2);
1383   2          }
1384   1      
1385   1          if (mark2 & 0x40)
1386   1          {
1387   2              clear_icon (page_main_internal_black, 16, 2);
1388   2          }
1389   1          else
1390   1          {
1391   2              display_uncolor_icon (page_main_internal_black, 16, 2);
1392   2          }
1393   1          //安全带未系
1394   1          if (mark2 & 0x20)
1395   1          {
1396   2              clear_icon (page_main_internal_black, 19, 2);
1397   2          }
1398   1          else
1399   1          {
1400   2              display_uncolor_icon (page_main_internal_black, 19, 2);
1401   2          }
1402   1      
1403   1              //胎压
1404   1        /*   if (mark2 & 0x10)
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 24  

1405   1          {
1406   1              clear_icon (page_main_internal_black, 1, 4);
1407   1          }
1408   1          else
1409   1          {
1410   1              display_uncolor_icon (page_main_internal_black, 1, 4);
1411   1          }   */
1412   1      
1413   1          //纯电模式
1414   1         /* switch(mark3 & 0xc0)
1415   1              {
1416   1                      case 0x40:
1417   1                              display_uncolor_gicon(page_main_internal_mark_ev,40,2);
1418   1                              break;
1419   1                      case 0x80:
1420   1                              display_uncolor_gicon(page_main_internal_mark_hv,40,2);
1421   1                              break;
1422   1                      case 0xc0:
1423   1                              display_uncolor_gicon(page_main_internal_mark_ranyou,40,2);
1424   1                              break;  
1425   1                      default:
1426   1                              clear_area_block(40,2,3,2);
1427   1                              break;
1428   1              }*/
1429   1          if (mark2 & 0x10)
1430   1          {
1431   2              clear_icon (page_main_internal_black, 40, 2);
1432   2          }
1433   1          else
1434   1          {
1435   2              display_uncolor_icon (page_main_internal_black, 40, 2);
1436   2          }
1437   1          //SOC符号片
1438   1          if (mark2 & 0x08)
1439   1          {
1440   2              clear_icon (page_main_internal_black, 43, 2);
1441   2          }
1442   1          else
1443   1          {
1444   2              display_uncolor_icon (page_main_internal_black, 43, 2);
1445   2          }
1446   1          //除霜 安全门
1447   1          if (mark2 & 0x04)
1448   1          {
1449   2              clear_icon (page_main_internal_black, 4, 2);
1450   2          }
1451   1          else
1452   1          {
1453   2              display_uncolor_icon (page_main_internal_black, 4, 2);
1454   2          }
1455   1              //小乌龟 
1456   1          if (mark2 & 0x02)
1457   1          {
1458   2              clear_icon (page_main_internal_black, 1, 2);
1459   2          }
1460   1          else
1461   1          {
1462   2              display_uncolor_icon (page_main_internal_black, 1, 2);
1463   2          }
1464   1          //asr
1465   1          if (mark2 & 0x01)
1466   1          {
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 25  

1467   2              clear_icon (page_main_internal_black, 46, 2);
1468   2          }
1469   1          else
1470   1          {
1471   2              display_uncolor_icon (page_main_internal_black, 46, 2);
1472   2          }
1473   1      
1474   1      
1475   1          switch (mark_door & 0x000000f0)
1476   1          {
1477   2              case 0x00000010:
1478   2                  display_uncolor_gicon (page_main_internal_mark_r, 28, 2);
1479   2                  break;
1480   2              case 0x00000020:
1481   2                  display_uncolor_gicon (page_main_internal_mark_n, 28, 2);
1482   2                  break;
1483   2              case 0x00000030:
1484   2                  display_uncolor_gicon (page_main_internal_mark_d, 28, 2);
1485   2                  break;
1486   2             /* case 0x00000040:
1487   2                  display_uncolor_gicon (page_main_internal_mark_d1, 28, 2);
1488   2                  break;
1489   2              case 0x00000050:
1490   2                  display_uncolor_gicon (page_main_internal_mark_d2, 28, 2);
1491   2                  break;
1492   2              case 0x00000060:
1493   2                  display_uncolor_gicon (page_main_internal_mark_d3, 28, 2);
1494   2                  break;
1495   2              case 0x00000070:
1496   2                  display_uncolor_gicon (page_main_internal_mark_d4, 28, 2);
1497   2                  break;
1498   2              case 0x00000080:
1499   2                  display_uncolor_gicon (page_main_internal_mark_d5, 28, 2);
1500   2                  break;
1501   2              case 0x00000090:
1502   2                  display_uncolor_gicon (page_main_internal_mark_d6, 28, 2);
1503   2                  break;
1504   2              case 0x000000a0:
1505   2                  display_uncolor_gicon (page_main_internal_mark_d7, 28, 2);
1506   2                  break;
1507   2              case 0x000000b0:
1508   2                  display_uncolor_gicon (page_main_internal_mark_d8, 28, 2);
1509   2                  break;
1510   2              case 0x000000c0:
1511   2                  display_uncolor_gicon (page_main_internal_mark_d9, 28, 2);
1512   2                  break;
1513   2              case 0x000000d0:
1514   2                  display_uncolor_gicon (page_main_internal_mark_d10, 28, 2);
1515   2                  break;
1516   2              case 0x000000e0:
1517   2                  display_uncolor_gicon (page_main_internal_mark_d11, 28, 2);
1518   2                  break;
1519   2              case 0x000000f0:
1520   2                  display_uncolor_gicon (page_main_internal_mark_d12, 28, 2);
1521   2                  break;*/
1522   2              default:
1523   2                  clear_area_block (28, 2, 3, 2);
1524   2                  break;
1525   2          }
1526   1      
1527   1          if ((mark_door & 0x00003000) == 0x00002000)
1528   1          {
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 26  

1529   2              display_uncolor_gicon (page_main_internal_mark_hong, 31, 2);
1530   2          }
1531   1          else
1532   1              if ((mark_door & 0x00003000) == 0x00001000)
1533   1              {
1534   2                  display_uncolor_gicon (page_main_internal_mark_bai, 31, 2);
1535   2              }
1536   1              else
1537   1              {
1538   2                  clear_area_block (31, 2, 3, 2);
1539   2              }
1540   1      
1541   1        /*  if ((mark_door & 0x00000c00) == 0x00000800)
1542   1          {
1543   1              display_uncolor_gicon (page_main_internal_mark_g_tx, 34, 2);
1544   1          }
1545   1          else
1546   1              if ((mark_door & 0x00000c00) == 0x00000400)
1547   1              {
1548   1                  display_uncolor_gicon (page_main_internal_mark_r_tx, 34, 2);
1549   1              }
1550   1              else
1551   1              {
1552   1                  clear_area_block (34, 2, 3, 2);
1553   1              }*/
1554   1      
1555   1              //超速报警
1556   1              if((mark_door & 0x00000800) == 0x00000800)
1557   1                      clear_icon (page_main_internal_black, 37, 2);
1558   1          else
1559   1                      display_uncolor_icon (page_main_internal_black, 37, 2);
1560   1              
1561   1          if ((mark_door & 0x00000300) == 0x00000200)
1562   1          {
1563   2              display_uncolor_gicon (page_main_internal_mark_y_stop, 34, 2);
1564   2          }
1565   1          else
1566   1              if ((mark_door & 0x00000300) == 0x00000100)
1567   1              {
1568   2                  display_uncolor_gicon (page_main_internal_mark_r_stop, 34, 2);
1569   2              }
1570   1              else
1571   1              {
1572   2                  clear_area_block (34, 2, 3, 2);
1573   2              }
1574   1      
1575   1          #if HAVE_READY
1576   1          if (mark_door & 0x00000008)
1577   1          {
1578   2              clear_icon (page_main_internal_black, 22, 2);
1579   2              clear_icon (page_main_internal_black, 25, 2);
1580   2          }
1581   1          else
1582   1          {
1583   2              display_uncolor_icon (page_main_internal_black, 22, 2);
1584   2              display_uncolor_icon (page_main_internal_black, 25, 2);
1585   2          }
1586   1          #endif
1587   1          #if DOOR_CAR
1588   1          if (mark_door & 0x00000004)
1589   1          {
1590   2              display_uncolor_gicon (page_main_internal_door_open_0, 16, 13);
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 27  

1591   2          }
1592   1          else
1593   1          {
1594   2              display_uncolor_gicon (page_main_internal_door_close_0, 16, 13);
1595   2          }
1596   1          if (mark_door & 0x00000002)
1597   1          {
1598   2              display_uncolor_gicon (page_main_internal_door_open_1, 31, 11);
1599   2          }
1600   1          else
1601   1          {
1602   2              display_uncolor_gicon (page_main_internal_door_close_1, 31, 11);
1603   2          }
1604   1          if (mark_door & 0x00000001)
1605   1          {
1606   2              display_uncolor_gicon (page_main_internal_door_open_2, 44, 11);
1607   2          }
1608   1          else
1609   1          {
1610   2              display_uncolor_gicon (page_main_internal_door_close_2, 44, 11);
1611   2          }
1612   1          #endif
1613   1      
1614   1      }
1615          void diplay_main_data (void)
1616          {
1617   1      
1618   1          displays16 (9, 7, total_voltage, 5, 0, GREEN, FULLSPACE, FONT_SMALL); //电池总电压
1619   1          displays16 (9, 8, total_current, 5, 0, GREEN, FULLSPACE, FONT_SMALL); //电池总电流
1620   1          displays16 (10, 12, motor_temp[0], 3, 0, GREEN, FULLSPACE, FONT_SMALL); //驱动电机温度
1621   1          displays16 (10, 13, motor_temp[1], 3, 0, GREEN, FULLSPACE, FONT_SMALL); //驱动电机控制器温度
1622   1          displayu16 (26, 7, mono_max_voltage, 2, 2, GREEN, FULLSPACE, FONT_SMALL); //单体最高电压
1623   1          displayu16 (26, 8, mono_min_voltage, 2, 2, GREEN, FULLSPACE, FONT_SMALL); //单体最低电压
1624   1          displays16 (42, 7, mono_max_temp, 3, 0, GREEN, FULLSPACE, FONT_SMALL); //单体最高温度
1625   1          displayu16 (11, 10, system_code, 5, 0, GREEN, FULLSPACE, FONT_SMALL); //系统故障代码
1626   1          displays16 (42, 8, mono_min_temp, 3, 0, GREEN, FULLSPACE, FONT_SMALL); //单体最低温度
1627   1          displayu16 (25, 9, dianhao, 3, 2, GREEN, FULLSPACE, FONT_SMALL); //百公里电耗
1628   1          //displays16 (9, 13, peidianhe_cur, 5, 0, GREEN, FULLSPACE, FONT_SMALL); //配电盒电流
1629   1          //displays16 (11, 12, peidianhe_temp, 3, 0, GREEN, FULLSPACE, FONT_SMALL); //配电盒电流
1630   1          displayu16 (10, 9, xushi_trip, 4, 0, GREEN, FULLSPACE, FONT_SMALL); //续驶里程
1631   1      
1632   1      
1633   1              displays16 (8, 14, shunshi_gonglv, 5, 1, GREEN, FULLSPACE, FONT_SMALL); //瞬时功率
1634   1              displays16 (8, 15, shengyu_gonglv, 5, 1, GREEN, FULLSPACE, FONT_SMALL); //剩余功率
1635   1              //displayu16 (10, 11, tms_fault_code, 5, 0, GREEN, FULLSPACE, FONT_SMALL); //TMS故障码
1636   1      }
1637          
1638          void display_air (void)
1639          {
1640   1      
1641   1          #if AIR_DISP
                  unsigned char i;
                  unsigned char count_all, count_only, color1, color2;
              
                  if (system_air.air1 < air_alarm)
                  {
                      color2 = iRED;
                      color1 = RED;
                  }
                  else
                  {
                      color2 = iGREEN;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 28  

                      color1 = GREEN;
                  }
                  count_all = system_air.air1 / 10;
                  count_only = system_air.air1 % 10;
                  if (system_air.air1 < system_air.last_air1)
                  {
                      clear_area_block (1, 5, 2, 10);
                  }
                  for (i = 0; i < count_all; i++)
                  {
                      display_icon (page_main_internal_air_9, color2, 1, 14 - i);
                  }
                  if (count_only != 0)
                  {
                      display_icon (*air_map[count_only - 1], color2, 1, 14 - i);
                  }
                  system_air.last_air1 = system_air.air1;
              
                  if (system_air.air2 < air_alarm)
                  {
                      color2 = iRED;
                      color1 = RED;
                  }
                  else
                  {
                      color2 = iGREEN;
                      color1 = GREEN;
                  }
                  count_all = system_air.air2 / 10;
                  count_only = system_air.air2 % 10;
                  if (system_air.air2 < system_air.last_air2)
                  {
                      clear_area_block (47, 5, 2, 10);
                  }
                  for (i = 0; i < count_all; i++)
                  {
                      display_icon (page_main_internal_air_9, color2, 47, 14 - i);
                  }
                  if (count_only != 0)
                  {
                      display_icon (*air_map[count_only - 1], color2, 47, 14 - i);
                  }
                  system_air.last_air2 = system_air.air2;
                  #endif
1697   1      }
1698          
1699          void display_soc (void)
1700          {
1701   1          #if BIG_SOC
                  if (system_air.last_soc != system_air.soc)
                  {
                      display_uncolor_gicon (*soc_map[system_air.soc], 9, 4);
                      system_air.last_soc = system_air.soc;
                  }
                  #endif
1708   1          #if SMALL_SOC
1709   1          unsigned char i;
1710   1          unsigned char count_all, count_only, color1, color2;
1711   1          if (system_air.soc < 20)
1712   1          {
1713   2              color2 = iRED;
1714   2              color1 = RED;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 29  

1715   2          }
1716   1          else
1717   1          {
1718   2              color2 = iGREEN;
1719   2              color1 = GREEN;
1720   2          }
1721   1          count_all = system_air.soc / 8;
1722   1          count_only = system_air.soc % 8;
1723   1          if (system_air.soc < system_air.last_soc)
1724   1          {
1725   2              clear_area_block (19, 16, 13, 1);
1726   2          }
1727   1          for (i = 0; i < count_all; i++)
1728   1          {
1729   2              display_icon (page_main_internal_soc_7, color2, 19 + i, 16);
1730   2          }
1731   1          if (count_only != 0)
1732   1          {
1733   2              display_icon (*soc_map[count_only - 1], color2, 19 + i, 16);
1734   2          }
1735   1          system_air.last_soc = system_air.soc;
1736   1          displayu8 (32, 16, system_air.soc, 3, 0, color1, FULLSPACE, FONT_SMALL);
1737   1          #endif
1738   1          #if DULI_SOC
                  unsigned char color;
                  if (system_air.soc < 20)
                  {
                      color = RED;
                  }
                  else
                  {
                      color = GREEN;
                  }
                  system_air.last_soc = system_air.soc;
                  displayu8 (32, 16, system_air.soc, 3, 0, color1, FULLSPACE, FONT_SMALL);
                  #endif
1751   1      }
1752          void display_system_time (void)
1753          {
1754   1          unsigned char BCD[10], i;
1755   1      
1756   1          BCD[0] = (system_time.year >> 4) & 0x0f;
1757   1          BCD[1] = system_time.year & 0x0f;
1758   1          BCD[2] = (system_time.month >> 4) & 0x0f;
1759   1          BCD[3] = system_time.month & 0x0f;
1760   1          BCD[4] = (system_time.day >> 4) & 0x0f;
1761   1          BCD[5] = system_time.day & 0x0f;
1762   1          BCD[6] = (system_time.hour >> 4) & 0x0f;
1763   1          BCD[7] = system_time.hour & 0x0f;
1764   1          BCD[8] = (system_time.minute >> 4) & 0x0f;
1765   1          BCD[9] = system_time.minute & 0x0f;
1766   1          for (i = 0; i < 10; i++)
1767   1          {
1768   2              if (BCD[i] > 9)
1769   2              {
1770   3                  BCD[i] = 0;
1771   3              }
1772   2          }
1773   1      
1774   1          display_uncolor_icon (*number_map[BCD[6]], 9, 16);
1775   1          display_uncolor_icon (*number_map[BCD[7]], 10, 16);
1776   1      
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 30  

1777   1      
1778   1          display_uncolor_icon (*number_map[BCD[8]], 12, 16);
1779   1          display_uncolor_icon (*number_map[BCD[9]], 13, 16);
1780   1      
1781   1          display_uncolor_icon (*number_map[BCD[0]], 5, 17);
1782   1          display_uncolor_icon (*number_map[BCD[1]], 6, 17);
1783   1      
1784   1          display_uncolor_icon (*number_map[BCD[2]], 8, 17);
1785   1          display_uncolor_icon (*number_map[BCD[3]], 9, 17);
1786   1      
1787   1          display_uncolor_icon (*number_map[BCD[4]], 11, 17);
1788   1          display_uncolor_icon (*number_map[BCD[5]], 12, 17);
1789   1      }
1790          void display_set_time (void)
1791          {
1792   1          unsigned char BCD[10], i;
1793   1          BCD[0] = (system_time.year >> 4) & 0x0f;
1794   1          BCD[1] = system_time.year & 0x0f;
1795   1          BCD[2] = (system_time.month >> 4) & 0x0f;
1796   1          BCD[3] = system_time.month & 0x0f;
1797   1          BCD[4] = (system_time.day >> 4) & 0x0f;
1798   1          BCD[5] = system_time.day & 0x0f;
1799   1          BCD[6] = (system_time.hour >> 4) & 0x0f;
1800   1          BCD[7] = system_time.hour & 0x0f;
1801   1          BCD[8] = (system_time.minute >> 4) & 0x0f;
1802   1          BCD[9] = system_time.minute & 0x0f;
1803   1          for (i = 0; i < 10; i++)
1804   1          {
1805   2              if (BCD[i] > 9)
1806   2              {
1807   3                  BCD[i] = 0;
1808   3              }
1809   2          }
1810   1          display_uncolor_icon (*number_map[BCD[6]], 19, 2);
1811   1          display_uncolor_icon (*number_map[BCD[7]], 20, 2);
1812   1          display_uncolor_icon (*number_map[BCD[8]], 22, 2);
1813   1          display_uncolor_icon (*number_map[BCD[9]], 23, 2);
1814   1          display_uncolor_icon (*number_map[BCD[0]], 21, 4);
1815   1          display_uncolor_icon (*number_map[BCD[1]], 22, 4);
1816   1          display_uncolor_icon (*number_map[BCD[2]], 24, 4);
1817   1          display_uncolor_icon (*number_map[BCD[3]], 25, 4);
1818   1          display_uncolor_icon (*number_map[BCD[4]], 27, 4);
1819   1          display_uncolor_icon (*number_map[BCD[5]], 28, 4);
1820   1      }
1821          
1822          void display_mileage (void)
1823          {
1824   1          unsigned char i, temp = 0;
1825   1          displayu16 (42, 16, system_meilage.trip, 4, 1, WHITE, FULLSPACE, FONT_SMALL);
1826   1      
1827   1          for (i = 0; i < 7; i++)
1828   1          {
1829   2              if (system_meilage.odo[i] > 0)
1830   2              {
1831   3                  temp = i;
1832   3              }
1833   2          }
1834   1          for (i = 0; i <= temp; i++)
1835   1          {
1836   2              display_uncolor_icon (*number_map[system_meilage.odo[i]], 46 - i, 17);
1837   2          }
1838   1          for (; i < 7; i++)
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 31  

1839   1          {
1840   2              clear_area_block (46 - i, 17, 1, 1);
1841   2          }
1842   1      }
1843          void display_fault_message (void)
1844          {
1845   1          static unsigned char yici = 1;
1846   1          if (system_page.current_page != 0x2e)
1847   1          {
1848   2              if (system_alarm.index == 0xff)
1849   2              {
1850   3                  #if ALARM_SDDD
                          if (yici)
                          {
                              clear_alarm_area();
                              display_uncolor_icon (page_main_internal_shidaidiandong, 7, 18);
                              yici = 0;
                          }
                          #else
1858   3                  clear_alarm_area();
1859   3                  #endif
1860   3                  system_alarm.last_index = 0xff;
1861   3              }
1862   2              else
1863   2              {
1864   3                  if ((system_alarm.index != system_alarm.last_index) || (system_alarm.last_number != system_ala
             -rm.number))
1865   3                  {
1866   4                      yici = 1;
1867   4                      clear_area_block (6, 18, 44, 2);
1868   4                      if ((system_alarm.index < 0x63) || ((system_alarm.index > 0x63) && (system_alarm.index < 0
             -x7c))\
1869   4                              || ((system_alarm.index > 0x82) && (system_alarm.index < 0xa0)))//|| (system_alarm
             -.index > 0xA9))
1870   4                      {
1871   5                          display_uncolor_icon (page_main_internal_fault_flag_red, 3, 18);
1872   5                          display_uncolor_gicon (*fault_map[system_alarm.index], 7, 18);
1873   5                          system_alarm.last_index = system_alarm.index;
1874   5                      }
1875   4                      #if ALARM_NUM
1876   4                      else if ((system_alarm.index > 194) && (system_alarm.index < 200))
1877   4                      {
1878   5                       /*   display_uncolor_icon (page_main_internal_fault_flag_red, 3, 18);
1879   5                          display_uncolor_gicon (*alarm_pos[system_alarm.number], 7, 18);
1880   5                          display_uncolor_gicon (*fault_map[system_alarm.index], (7 + alarm_pos[system_alarm.num
             -ber]->width), 18);
1881   5                          system_alarm.last_index = system_alarm.index; */
1882   5      
1883   5                                              unsigned int num = system_alarm.number & 0x07;                          
1884   5                                              display_uncolor_icon(page_main_internal_fault_flag_red,3,18);   
1885   5                                              if(num > 0)
1886   5                                              {
1887   6                                                      display_uncolor_gicon(*alarm_pos[num - 1],7,18);
1888   6                                                      display_uncolor_gicon(*fault_map[system_alarm.index],(7 + alarm_pos[num - 1]->width),18);       
1889   6                                              }
1890   5                                              else
1891   5                                                      display_uncolor_gicon(*fault_map[system_alarm.index],7,18);                              
1892   5                      }  
1893   4                                      
1894   4                                      else if((system_alarm.index > 0xb8) && (system_alarm.index < 0xc3))
1895   4                      {
1896   5                          display_uncolor_icon (page_main_internal_fault_flag_red, 3, 18);
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 32  

1897   5                                              display_uncolor_gicon (*fault_map[system_alarm.index], 7, 18);
1898   5                                              if(system_alarm.number > 0)
1899   5                              displayu8(7 + fault_map[system_alarm.index]->width,18,system_alarm.number,3,0,WHITE,F
             -ULLZERO,FONT_MEDIUM);
1900   5                          system_alarm.last_index = system_alarm.index;
1901   5                      }
1902   4                     /* else if (system_alarm.index == 0x63)
1903   4                      {
1904   4                          display_uncolor_icon (page_main_internal_fault_flag_red, 3, 18);
1905   4                          displayu8 (7, 18, system_alarm.number, 2, 0, WHITE, FULLSPACE, FONT_MEDIUM);
1906   4                          display_uncolor_gicon (*fault_map[system_alarm.index], 9, 18);
1907   4                          system_alarm.last_index = system_alarm.index;
1908   4                      }*/
1909   4                      system_alarm.last_number = system_alarm.number;
1910   4                      #endif
1911   4                  }
1912   3              }
1913   2          }
1914   1      }
1915          //------------------------------------------------------------------------------------
1916          void display_init (void)
1917          {
1918   1          unsigned char i,j;
1919   1          system_page.last_page = ID_PAGE_START;
1920   1          system_page.current_page = 0x52;
1921   1          buzzer = 0;
1922   1          mark_door = 0;
1923   1          mark2 = 0;
1924   1              mark3 = 0;
1925   1          menu = 0;
1926   1          page_xuanze = 0;
1927   1          para_cmd = 0;
1928   1          speed_scale = 0;
1929   1          baimi_pulse = 0;
1930   1          scale_factor = 100;
1931   1          system_bright = 0;
1932   1          system_video = 0;//tv1-4
1933   1          system_air.air1 = 0;
1934   1          system_air.air2 = 0;
1935   1          system_air.soc = 0;
1936   1          system_meilage.trip = 0;
1937   1          system_time.day = 0;
1938   1          system_time.hour = 0;
1939   1          system_time.minute = 0;
1940   1          system_time.year = 0;
1941   1          system_time.month = 0;
1942   1          for (i = 0; i < 7; i++)
1943   1          {
1944   2              system_meilage.odo[i] = 0;
1945   2          }
1946   1      
1947   1          system_alarm.index = 0xff;
1948   1          system_alarm.number = 0;
1949   1          system_alarm.last_number = 0;
1950   1          system_alarm.last_index = 0xff;
1951   1          system_air.last_air1 = 0;
1952   1          system_air.last_air2 = 0;
1953   1          system_air.last_soc = 0;
1954   1      
1955   1          system_b_password.blink = 0xff;
1956   1          for (i = 0; i < 4; i++)
1957   1          {
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 33  

1958   2              system_b_password.para[i] = 0;
1959   2          }
1960   1          system_b_odo_char.blink = 0xff;
1961   1          for (i = 0; i < 44; i++)
1962   1          {
1963   2              system_b_odo_char.para[i] = 0;
1964   2          }
1965   1          system_b_set.blink = 0xff;
1966   1          for (i = 0; i < 11; i++)
1967   1          {
1968   2              system_b_set.para[i] = 0;
1969   2          }
1970   1      
1971   1          uart_cmd = 0;
1972   1          dandu_disp = 0;
1973   1      
1974   1          meter_status[0] = 0;
1975   1          meter_status[1] = 0;
1976   1          meter_status[2] = 0;
1977   1          meter_status[3] = 0x55;
1978   1          meter_para_A2 = 0;
1979   1          meter_para_A3 = 0;
1980   1          meter_para_A4 = 0;
1981   1              meter_para_K = 0;
1982   1          meter_para_A5 = 0;
1983   1          meter_para_A13 = 0;
1984   1          meter_para_A14 = 0;
1985   1          meter_para_A15 = 0;
1986   1          #if MODULE_FRONT_B40
1987   1          front_status[0] = 0x5555;
1988   1          front_status[1] = 0x5555;
1989   1          front_status[2] = 0;
1990   1          front_status[3] = 0;
1991   1          front_para_A25 = 0;
1992   1          front_para_A40 = 0;
1993   1          front_para_A26 = 0;
1994   1          #endif
1995   1          #if MODULE_REAR_B40
1996   1          rear_status[0] = 0x5555;
1997   1          rear_status[1] = 0x5555;
1998   1          rear_status[2] = 0;
1999   1          rear_status[3] = 0;
2000   1          rear_para_A25 = 0;
2001   1          rear_para_A40 = 0;
2002   1          rear_para_A26 = 0;
2003   1          #endif
2004   1          #if MODULE_TOP_B40
                  top_status[0] = 0x5555;
                  top_status[1] = 0x5555;
                  top_status[2] = 0;
                  top_status[3] = 0;
                  top_para_A25 = 0;
                  top_para_A40 = 0;
                  top_para_A26 = 0;
                  #endif
2013   1          #if MODULE_FRONT_B50
                  front_status[0] = 0;
                  front_status[1] = 0;
                  for (i = 0; i < 7; i++)
                  {
                      front_para[i] = 0;
                  }
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 34  

                  for (i = 0; i < 6; i++)
                  {
                      front_out_status[i] = 0;
                  }
                  #endif
2025   1          #if MODULE_REAR_B50
                  rear_status[0] = 0;
                  rear_status[1] = 0;
                  for (i = 0; i < 7; i++)
                  {
                      rear_para[i] = 0;
                  }
                  for (i = 0; i < 6; i++)
                  {
                      rear_out_status[i] = 0;
                  }
                  #endif
2037   1          #if MODULE_TOP_B50
                  top_status[0] = 0;
                  top_status[1] = 0;
                  for (i = 0; i < 7; i++)
                  {
                      top_para[i] = 0;
                  }
                  for (i = 0; i < 6; i++)
                  {
                      top_out_status[i] = 0;
                  }
                  #endif
2049   1          air1_factor = 0;
2050   1          air2_factor = 0;
2051   1          speed_alarm = 0;
2052   1          air_alarm = 0;
2053   1          oil_alarm = 0;
2054   1          fuel_alarm = 0;
2055   1          for (i = 0; i < 5; i++)
2056   1          {
2057   2              vedio_enable[i] = 0;
2058   2          }
2059   1          wiper_sec = 3;
2060   1          meter_input = 0;
2061   1          meter_output = 0;
2062   1      
2063   1          //-----------------------------------------------------------------
2064   1          li_battery_level = 0;
2065   1          system_status = 0;
2066   1          xudianchi_voltage = 0;
2067   1          system_code = 0;
2068   1          xushi_trip = 0;
2069   1          motor_zhuansu = 0;
2070   1          total_voltage = 0;
2071   1          total_current = 0;
2072   1      
2073   1          dongli_input_voltage = 0;
2074   1          dongli_input_current = 0;
2075   1          siji_status = 0;
2076   1          onoff_status = 0;
2077   1          bus_life = 0;
2078   1          bus_mode = 0;
2079   1          for (i = 0; i < 6; i++)
2080   1          {
2081   2              bus_yuliu[i] = 0;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 35  

2082   2          }
2083   1          youmen_taban = 0;
2084   1          zhidong_taban = 0;
2085   1              dianchi_soc = 0;
2086   1          for (i = 0; i < 7; i++)
2087   1          {
2088   2              bus_version[i] = 0;
2089   2          }
2090   1          for (i = 0; i < 2; i++)
2091   1          {
2092   2              motor_temp[i] = 0;
2093   2          }
2094   1          motor_zhuanju = 0;
2095   1       
2096   1      
2097   1          dcdc_output_voltage = 0;
2098   1          dcdc_output_current = 0;
2099   1          dcdc_input_voltage = 0;
2100   1          dcdc_temp = 0;
2101   1          dcdc_fault = 0;
2102   1          dcac_fault = 0;
2103   1          dcac_w_current = 0;
2104   1          dcac_v_current = 0;
2105   1          dcac_u_current = 0;
2106   1          dcac_temp = 0;
2107   1          motor_zhju = 0;
2108   1          riso_zheng = 0;
2109   1          riso_fu = 0;
2110   1          riso_life = 0;
2111   1          riso_fault = 0;
2112   1          riso_loudian = 0;
2113   1      
2114   1          for (i = 0; i < 8; i++)
2115   1          {
2116   2              tiaoshi_canshu[i] = 0;
2117   2          }
2118   1      
2119   1          chongdian_current = 0;
2120   1          fangdian_current = 0;
2121   1          mono_max_voltage = 0;
2122   1          mono_min_voltage = 0;
2123   1          mono_pingjun_voltage = 0;
2124   1          mono_max_temp = 0;
2125   1          mono_min_temp = 0;
2126   1          battery_riso_zheng = 0;
2127   1          battery_riso_fu = 0;
2128   1          for (i = 0; i < 5; i++)
2129   1          {
2130   2              battery_status[i] = 0;
2131   2          }
2132   1      
2133   1          vin_status = 0;
2134   1          battery_fault_suliang = 0;
2135   1          mono_binglian_shuliang = 0;
2136   1          mono_tanzhen_shuliang = 0;
2137   1          for (i = 0; i < 4; i++)
2138   1          {
2139   2              chongdian_temp[i] = 0;
2140   2          }
2141   1          eding_rongliang = 0;
2142   1          eding_voltage = 0;
2143   1          mono_chuanlian_shuliang = 0;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 36  

2144   1      
2145   1          mono_min_temp = 0;
2146   1          mono_max_t_xiang = 0;
2147   1          mono_max_t_jie = 0;
2148   1          mono_min_t_xiang = 0;
2149   1          mono_min_t_jie = 0;
2150   1          mono_max_v_xiang = 0;
2151   1          mono_max_v_jie = 0;
2152   1          mono_min_v_xiang = 0;
2153   1          mono_min_v_jie = 0;
2154   1          battery_leixing = 0;
2155   1          battery_lengque = 0;
2156   1          for (i = 0; i < 4; i++)
2157   1          {
2158   2              battery_yuliu[i] = 0;
2159   2          }
2160   1      
2161   1          for (i = 0; i < 10; i++)
2162   1          {
2163   2              dianchi_bianhao[i] = 0;
2164   2              dianchi_mono_voltage[i] = 0;
2165   2              dianchi_mono_temp[i] = 0;
2166   2              dianchi_xianghao[i] = 0;
2167   2          }
2168   1      
2169   1          air_fuhe = 0;
2170   1          air_set_temp = 0;
2171   1          air_wai_temp = 0;
2172   1          air_nei_temp = 0;
2173   1          air_current = 0;
2174   1          air_status = 0;
2175   1          air_life = 0;
2176   1      
2177   1          miehuoqi_xiang = 0;
2178   1          miehuoqi_yujing = 0;
2179   1          miehuoqi_fault = 0;
2180   1          miehuoqi_qingqiu = 0;
2181   1          for (i = 0; i < 5; i++)
2182   1          {
2183   2              yanwu_status[i] = 0;
2184   2          }
2185   1          yanwu_life = 0;
2186   1      
2187   1          dianchi_fenxian = 0;
2188   1      
2189   1          yzt_status = 0;
2190   1      
2191   1          motor_con_cur = 0;
2192   1          qiben1 = 0;
2193   1          qiben2 = 0;
2194   1          qiben3 = 0;
2195   1          qiben4 = 0;
2196   1          qiben5 = 0;
2197   1      
2198   1      
2199   1          //peidianhe_cur = 0;
2200   1         // peidianhe_temp = 0;
2201   1         // peidianhe_vol = 0;
2202   1      
2203   1          for (i = 0; i < 2; i++)
2204   1          {
2205   2              youbeng_life[i] = 0;
C51 COMPILER V9.00   DISPLAY                                                               12/13/2022 09:00:39 PAGE 37  

2206   2              youbeng_status[i] = 0;
2207   2              youbeng_zhuansu[i] = 0;
2208   2              youbeng_cur[i] = 0;
2209   2              youbeng_temp[i] = 0;
2210   2          }
2211   1          for (i = 0; i < 2; i++)
2212   1          {
2213   2              youbeng[i] = 0;
2214   2          }
2215   1          guzhangdaima = 0;
2216   1          diduan_vol = 0;
2217   1          yingjianbanben = 0;
2218   1          ruanjianbanben = 0;
2219   1          gaoduan_vol = 0;
2220   1          dianji_temp = 0;
2221   1      
2222   1          for (i = 0; i < 6; i++)
2223   1                      for (j = 0; j < 8; j++)
2224   1                              surface_data[i][j] = 0;
2225   1              runhua1 = 0;
2226   1              //peidianhe_status = 0;
2227   1              yugua_time = 0;
2228   1              shunshi_gonglv = 0;
2229   1              shengyu_gonglv = 0;
2230   1              elec_control_code = 0;
2231   1              tms_fault_code = 0;
2232   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  10370    ----
   CONSTANT SIZE    =    618    ----
   XDATA SIZE       =     26      57
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
